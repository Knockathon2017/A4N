<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>TripWay :: Make your trip easy</title>

    <!-- Bootstrap -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/custom.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body onload="initialize()">
    <div class="container-fluid header">
        <div class="row">
            <div class="col-sm-3">
                <h1>Trip<span>Way</span> | <span class="punch">Make your trip easy</span></h1>
            </div>
        </div>
    </div>
    <section class="darkSection">
        <div class="container">
            <div class="row gridResize">
                <div class="col-sm-2 col-xs-12">
                    <div class="sectionTitleDouble">
                        <p>Plan</p>
                        <h2>your <span>Trip</span></h2>
                    </div>
                </div>
                <div class="col-sm-9 col-xs-12">
                    <div class="row">
                        <div class="col-sm-4 col-xs-12">
                            <div class="searchTour">
                                <input type="text" id="result" placeholder="Exzeo Software, Sector 62, Noida" class="form-control textbox" style="padding-left:15px;">
                                <span>From</span>
                                <a href="javascript:void(0)" class="clocation" onclick="detectmylocation()" title="Click for current location"><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i></a>
                            </div>
                        </div>
                        <div class="col-sm-4 col-xs-12">
                            <div class="searchTour">
                                <input type="text" id="destinationinput" placeholder="New Delhi" class="form-control textbox">
                                <span>To</span>
                            </div>
                        </div>
                        <div class="col-sm-1 col-xs-12">
                            <div class="searchTour">
                                <input type="number" id="timeinput" value="0" placeholder="0" class="form-control textbox">
                                <span>Time(Hrs)</span>
                            </div>
                        </div>
                        <!--<div class="col-sm-1 col-xs-12">
                            <div class="searchTour">
                                <input type="number" placeholder="0" class="form-control textbox">
                                <span>Adult</span>
                            </div>
                        </div>
                        <div class="col-sm-1 col-xs-12">
                            <div class="searchTour">
                                <input type="number" placeholder="0" class="form-control textbox">
                                <span>Child</span>
                            </div>
                        </div>
                        <div class="col-sm-1 col-xs-12">
                            <div class="searchTour">
                                <input type="number" placeholder="0" class="form-control textbox">
                                <span>Age<60</span>
                            </div>
                        </div>-->


                    </div>
                </div>
                <div class="col-sm-1 col-xs-12" style="padding:0;">
                    <a href="javascript:void(0)" onclick="changelocation()" class="btn btn-block buttonCustomPrimary">Search</a>
                </div>
            </div>
        </div>
    </section>

    <section class="front hide" id="introslide">
    </section>

    <section class="result">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-9 result">
                    <div id="map_canvas" style="position: absolute; width:100%; height:100%; left:0; top:0;"></div>
                    <div id="control_panel" style="float:right;width:30%;text-align:left;padding-top:20px">
                        <div id="directions_panel" style="margin:20px;background-color:#FFEE77;"></div>
                    </div>
                </div>
                <div class="col-sm-3 placelisting" onclick=tickfunc();>


                </div>
            </div>
        </div>
    </section>
    </section>

    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
    </script>
    <script type="text/javascript">
    </script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="assets/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&key=AIzaSyDVDNY_xUq0LKpNswJ_d4U5_r2u2hmd1m4"></script>
    <script>
        $('#introslide').css({
            'height': (($(window).height()) - 170) + 'px'
        });
        $(window).resize(function () {
            $('#introslide').css({
                'height': (($(window).height()) - 170) + 'px'
            });
        });

        $('.result').css({
            'height': (($(window).height()) - 40) + 'px'
        });
        $(window).resize(function () {
            $('.result').css({
                'height': (($(window).height()) - 40) + 'px'
            });
        });

        $('.placelisting').css({
            'height': (($(window).height()) - 175) + 'px'
        });
        $(window).resize(function () {
            $('.placelisting').css({
                'height': (($(window).height()) - 175) + 'px'
            });
        });
    </script>
    <script type="text/javascript">
        var directionDisplay;
        var directionsService = new google.maps.DirectionsService();
        var map;
        var myHomeLocation = "a-42/6, 6th floor, pinnacle tower, exzeo software, noida sector-62, up-201301";

        function initialize(origin) {
            debugger;
            directionsDisplay = new google.maps.DirectionsRenderer();
            var chicago = new google.maps.LatLng(28.626663, 77.209015);
            var myOptions = {
                zoom: 6,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                center: chicago
            };
            map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            directionsDisplay.setMap(map);
            
            var url = $("#result").val() !== undefined && $("#result").val().length > 0 ? "/callgoogleapi?q="+$("#result").val()+"" : "/callgoogleapi";
            debugger;
            $.ajax({
                type: "GET",
                url: url,
                error: function (jqXHR, textStatus, errorThrown) {

                    console.log("error");
                },
                success: function (data) {
                    $(".placelisting").empty();
                    // var jsonData = JSON.parse(data);
                    var jsonData = data;
                    var addressArray = [];
                    if (jsonData !== undefined) {
                        for (var index = 0; index < jsonData.length; index++) {
                            var element = jsonData[index];
                            // var location = element.geometry.location;
                            var address = element.address;
                            // addressArray.push(address);
                            var obj = {
                                address: address
                            };
                            addressArray.push(obj);
                            var place_name = element.name;
                        }
                        debugger;
                        console.log("location");
                        console.log(addressArray);
                        // myfunc(data);
                        createDiv(data);
                    }
                    debugger;
                    //DestinationSourceAndTimerRoute(directionsService, directionsDisplay, addressArray, 6);
                    // calculateAndDisplayRoute(directionsService, directionsDisplay, addressArray);
                    if(parseInt($("#timeinput").val()) !== undefined && parseInt($("#timeinput").val()) !== 0){
                        debugger;
                        SourceAndTimerRoute(directionsService, directionsDisplay, addressArray, $("#result").val(), parseInt($("#timeinput").val()));
                    }else if($("#destinationinput").val() !== undefined && $("#destinationinput").val().length > 0)
                        DestinationSourceAndTimerRoute(directionsService, directionsDisplay, addressArray,"Mehrauli, New Delhi, Delhi 110030, India", $("#result").val(), parseInt($("#timeinput").val()));
                    else
                        calculateAndDisplayRoute(directionsService, directionsDisplay, addressArray, origin);
                }
            });
        }

        //initail call on load
        function calculateAndDisplayRoute(directionsService, directionsDisplay, addressArray, origin) {
            var waypts = [];
            // var checkboxArray = document.getElementById('waypoints');
            var checkboxArray = addressArray;
            for (var i = 0; i < checkboxArray.length; i++) {
                waypts.push({
                    location: checkboxArray[i].address,
                    stopover: true
                });
            }
            var myorigin = origin === undefined || origin.length <= 0 ? myHomeLocation : origin;
            directionsService.route({
                origin: myorigin,
                // destination: document.getElementById('end').value,
                //  origin: checkboxArray[0].address,
                destination: checkboxArray[checkboxArray.length - 1].address,
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: 'DRIVING'
            }, function (response, status) {
                debugger;
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    debugger;
                    var route = response.routes[0];
                    // var summaryPanel = document.getElementById('directions_panel');
                    // summaryPanel.innerHTML = '';
                    // // For each route, display summary information.
                    // for (var i = 0; i < route.legs.length; i++) {

                    //     var routeSegment = i + 1;
                    //     summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
                    //         '</b><br>';
                    //     summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
                    //     summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                    //     summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
                    //     summaryPanel.innerHTML += route.legs[i].duration.text + '<br><br>';
                    // }
                } else {
                    // window.alert('Directions request failed due to ' + status);
                }
            });
        }
        // call using timer
        function SourceAndTimerRoute(directionsService, directionsDisplay, addressArray,source, timer) {
            debugger;
            var waypts = [];
            // var checkboxArray = document.getElementById('waypoints');
            var checkboxArray = addressArray;
            for (var i = 0; i < checkboxArray.length; i++) {
                waypts.push({
                    location: checkboxArray[i].address,
                    stopover: true
                });
            }
            directionsService.route({
                // origin: document.getElementById('start').value,
                // destination: document.getElementById('end').value,
                origin: source,
                destination: checkboxArray[checkboxArray.length - 1].address,
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: 'DRIVING'
            }, function (response, status) {
                if (status === 'OK') {
                    var time = timer * 60;
                    var drawloc = TimerCalc(response, time);
                    //console.log(drawloc);
                    directionsDisplay.setDirections(drawloc);
                    var route = response.routes[0];
                    // var summaryPanel = document.getElementById('directions_panel');
                    // summaryPanel.innerHTML = '';
                    // // For each route, display summary information.
                    // for (var i = 0; i < route.legs.length; i++) {

                    //     var routeSegment = i + 1;
                    //     summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
                    //         '</b><br>';
                    //     summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
                    //     summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                    //     summaryPanel.innerHTML += route.legs[i].distance.text + '<br><br>';
                    //     summaryPanel.innerHTML += route.legs[i].duration.text + '<br><br>';
                    // }
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        // function tickfunc(){
        //     debugger;
        //     initialize("Mehrauli, New Delhi, Delhi 110030, India");
        //     debugger;
        //     }
        // call using timerwith destination
        function DestinationSourceAndTimerRoute(directionsService, directionsDisplay, addressArray, dest, source, timer) {
            var waypts = [];
            var checkboxArray = addressArray;
            directionsService.route({
                origin: source,
                destination: dest,
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: 'DRIVING'
            }, function (response, status) {
                if (status === 'OK') {
                    if (timer == 0 || timer === undefined)
                        directionsDisplay.setDirections(drawloc);
                    else {
                         var timeinmin = timer * 60;
                        //var timeinmin = 65;
                        var route1 = response.routes[0];
                        if (timeinmin > parseInt(route1.legs[0].duration.text)) {
                            for (var i = 0; i < checkboxArray.length; i++) {
                                waypts.push({
                                    location: checkboxArray[i].address,
                                    stopover: true
                                });
                            }
                            // var destin =
                            //     "Mehrauli-Badarpur Road, Village : Said-ul-Ajaib, Near Saket Metro Station, New Delhi, Delhi 110030, India";
                            directionsService.route({
                                origin: source,
                                destination: dest,
                                waypoints: waypts,
                                optimizeWaypoints: true,
                                travelMode: 'DRIVING'
                            }, function (response, status) {
                                if (status === 'OK') {
                                    debugger;
                                    TimerSDCalc(response, timeinmin, source, dest);
                                   // directionsDisplay.setDirections(drawloc);
                                  //  var route = response.routes[0];
                                }
                                // } else {
                                //     window.alert('Directions request failed due to ' + status);
                                // }
                            });
                        } else {
                            window.alert('timer is wrong estimate...');
                        }
                        // var route = response.routes[0];
                    }
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        function detectmylocation() {
            document.getElementById("result").value = myHomeLocation;
        }

        function changelocation() {

            initialize($("#result").val());
        }
        // function detectmylocation(){
        //     $.ajax({
        //         type: "GET",
        //         url: "/myclocation",
        //         error: function (jqXHR, textStatus, errorThrown) {
        //             
        //             console.log("error");
        //             return false;
        //         },
        //         success: function (data) {
        //             
        //             // var jsonData = JSON.parse(data);
        //         }
        //     });
        // }

        //TimerCalculator
        function TimerCalc(res, timerhour) {
            var timercall = res.routes[0].legs;
            var sum = 0;
            for (i = 0; i < timercall.length; i++) {
                if (sum >= timerhour) {
                    break;
                } else
                    sum = sum + parseInt(timercall[i].duration.text)
            }
            //for (j = 0; j < res.geocoded_waypoints.length; j++) {
            //   if (j >= i) {
            // res.geocoded_waypoints.slice(0, j);
            res.geocoded_waypoints = res.geocoded_waypoints.slice(0, i);
            res.routes[0].legs = res.routes[0].legs.slice(0, i);
            res.routes[0].waypoint_order = res.routes[0].waypoint_order.slice(0, i);
            //  }
            //return resp;
            //  }


            res.request.destination.query = res.routes[0].legs[i - 1].end_address;
            return res;
        }
        // $.ajax({
        //     type: "GET",
        //     url: "/callgoogleapi",
        //     error: function (jqXHR, textStatus, errorThrown) {
        //         debugger;
        //         console.log("error");
        //     },
        //     success: function (data) {
        //         debugger;
        //         createDiv(data);
        //         // var jsonData = JSON.parse(data);

        //     }
        // });


        //Timerwith source and destinationCalculator
        function TimerSDCalc(res, timermin, source, dest) {
            var newlocat = [];
            var waypts = [];
            var timercall = res.routes[0].legs;
            var sum = 0;
             newlocat.push(timercall[timercall.length - 1].end_address);
            sum = sum + parseInt(timercall[timercall.length - 1].duration.text)
            for (i = 0; i <= timercall.length - 1; i++) {
                if (sum >= timermin) {
                    break;
                } else {
                    //var loc =timercall[i].end_address;
                   newlocat.push(timercall[i].end_address);
                    sum = sum + parseInt(timercall[i].duration.text);
                }
            }
            for (var i = 0; i < newlocat.length; i++) {
                waypts.push({
                    location: newlocat[i],
                    stopover: true
                });
                directionsService.route({
                    origin: source,
                    destination: dest,
                    waypoints: waypts,
                    optimizeWaypoints: true,
                    travelMode: 'DRIVING'
                }, function (response, status) {
                    if (status === 'OK') {
                        // debugger;
                        // var drawloc = TimerSDCalc(response, timeinmin);
                        directionsDisplay.setDirections(response);
                        var route = response.routes[0];
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            }}

            //TimerCalculator
            function TimerCalcWithDestination(res, timerhour, detination) {
                debugger;
                var timercall = res.routes[0].legs;
                var sum = 0;
                for (i = 0; i < timercall.length; i++) {
                    if (sum >= timerhour) {
                        break;
                    } else
                        sum = sum + parseInt(timercall[i].duration.text)
                }
                res.geocoded_waypoints = res.geocoded_waypoints.slice(0, i);
                res.routes[0].legs = res.routes[0].legs.slice(0, i);
                res.routes[0].waypoint_order = res.routes[0].waypoint_order.slice(0, i);
                debugger;
                return res;
            }

         //filter exclude
        // function excludeFilter(directionsService, directionsDisplay, addressArray,excludearray) {
        //     var waypts = [];
        //     // var checkboxArray = document.getElementById('waypoints');
        //     var checkboxArray = addressArray;
        //     var index = checkboxArray.indexOf(excludearray);
        //     checkboxArray.splice(index,1);
        //     directionsService.route({
        //         origin: "TATA Housing Group, A-13/1, Synergy Tower, 5th Floor, Sector-62, Block B, Industrial Area, Sector 62, Noida, Uttar Pradesh 201301, India",
        //         // destination: document.getElementById('end').value,
        //         //  origin: checkboxArray[0].address,
        //         destination: checkboxArray[checkboxArray.length - 1].address,
        //         waypoints: waypts,
        //         optimizeWaypoints: true,
        //         travelMode: 'DRIVING'
        //     }, function (response, status) {
        //         if (status === 'OK') {
        //             directionsDisplay.setDirections(response);
        //             }
        //         } else {
        //             window.alert('Directions request failed due to ' + status);
        //         }
        //     });
            
        //     }
       // }


        function createDiv(data) {
            var $mainContainer = $(".placelisting");
            for (i = 0; i < data.length; i++) {
                var newDiv = $('<div class="row"> <div class="col-sm-4" style="padding-right:0;"> <img src="' + data[i]
                    .icon +
                    '" class="img-responsive" alt=""> <div itemprop="name" class="star"> <div class="item__stars-badges"> <div class="item__stars-wrp"><span class="icon-ic item__star"><svg xmlns="http://www.w3.org/2000/svg" focusable="false" tabindex="-1" width="12" height="12" viewBox="0 0 12 12"><path class="svg-color--primary" fill="#F6AB3F" d="M11.988 5.21c-.052-.275-.27-.488-.545-.534l-3.604-.6L6.63.455C6.542.184 6.287 0 6 0s-.542.184-.632.456L4.16 4.076l-3.603.6c-.275.046-.493.26-.545.533-.052.273.072.55.312.695L3.2 7.63l-1.165 3.493c-.093.28.01.59.25.758.115.08.25.12.382.12.148 0 .295-.05.416-.146L6 9.52l2.917 2.333c.12.098.27.147.416.147.133 0 .267-.04.38-.12.244-.17.346-.478.252-.758L8.8 7.63l2.876-1.725c.24-.144.364-.422.312-.696z"></path></svg></span> <span class="icon-ic item__star"> <svg xmlns="http://www.w3.org/2000/svg" focusable="false" tabindex="-1" width="12" height="12" viewBox="0 0 12 12"> <path class="svg-color--primary" fill="#F6AB3F" d="M11.988 5.21c-.052-.275-.27-.488-.545-.534l-3.604-.6L6.63.455C6.542.184 6.287 0 6 0s-.542.184-.632.456L4.16 4.076l-3.603.6c-.275.046-.493.26-.545.533-.052.273.072.55.312.695L3.2 7.63l-1.165 3.493c-.093.28.01.59.25.758.115.08.25.12.382.12.148 0 .295-.05.416-.146L6 9.52l2.917 2.333c.12.098.27.147.416.147.133 0 .267-.04.38-.12.244-.17.346-.478.252-.758L8.8 7.63l2.876-1.725c.24-.144.364-.422.312-.696z"></path> </svg> </span><span class="icon-ic item__star"><svg xmlns="http://www.w3.org/2000/svg" focusable="false" tabindex="-1" width="12" height="12" viewBox="0 0 12 12"><path class="svg-color--primary" fill="#F6AB3F" d="M11.988 5.21c-.052-.275-.27-.488-.545-.534l-3.604-.6L6.63.455C6.542.184 6.287 0 6 0s-.542.184-.632.456L4.16 4.076l-3.603.6c-.275.046-.493.26-.545.533-.052.273.072.55.312.695L3.2 7.63l-1.165 3.493c-.093.28.01.59.25.758.115.08.25.12.382.12.148 0 .295-.05.416-.146L6 9.52l2.917 2.333c.12.098.27.147.416.147.133 0 .267-.04.38-.12.244-.17.346-.478.252-.758L8.8 7.63l2.876-1.725c.24-.144.364-.422.312-.696z"></path></svg></span> <span class="icon-ic item__star"> <svg xmlns="http://www.w3.org/2000/svg" focusable="false" tabindex="-1" width="12" height="12" viewBox="0 0 12 12"> <path class="svg-color--primary" fill="#F6AB3F" d="M11.988 5.21c-.052-.275-.27-.488-.545-.534l-3.604-.6L6.63.455C6.542.184 6.287 0 6 0s-.542.184-.632.456L4.16 4.076l-3.603.6c-.275.046-.493.26-.545.533-.052.273.072.55.312.695L3.2 7.63l-1.165 3.493c-.093.28.01.59.25.758.115.08.25.12.382.12.148 0 .295-.05.416-.146L6 9.52l2.917 2.333c.12.098.27.147.416.147.133 0 .267-.04.38-.12.244-.17.346-.478.252-.758L8.8 7.63l2.876-1.725c.24-.144.364-.422.312-.696z"></path> </svg> </span><span class="icon-ic item__star"><svg xmlns="http://www.w3.org/2000/svg" focusable="false" tabindex="-1" width="12" height="12" viewBox="0 0 12 12"><path class="svg-color--primary" fill="#F6AB3F" d="M11.988 5.21c-.052-.275-.27-.488-.545-.534l-3.604-.6L6.63.455C6.542.184 6.287 0 6 0s-.542.184-.632.456L4.16 4.076l-3.603.6c-.275.046-.493.26-.545.533-.052.273.072.55.312.695L3.2 7.63l-1.165 3.493c-.093.28.01.59.25.758.115.08.25.12.382.12.148 0 .295-.05.416-.146L6 9.52l2.917 2.333c.12.098.27.147.416.147.133 0 .267-.04.38-.12.244-.17.346-.478.252-.758L8.8 7.63l2.876-1.725c.24-.144.364-.422.312-.696z"></path></svg></span></div> </div> </div> </div> <div class="col-sm-8"> <div class="itemdetails"> <h3>' +
                    data[i].name + '</h3> <p>' + data[i].address +
                    '</p> <span class="visittime"><i class="glyphicon glyphicon-time" aria-hidden="true"></i> 2Hrs</span> <span class="visittime"><i class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></i> ' +
                    data[i].rating +
                    '</span> <a class="exclude"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span> exclude</a> </div> </div> </div>'
                );
                $mainContainer.append(newDiv);
            }
        }

    </script>
</body>

</html>